---
layout: post
title: "COVID-19"
---
If you are reading this, it is unlikely you are unaware of the COVID-19 pandemic. Either way, before quantifying the effects of this pandemic let's consider what led us to this state.

COVID-19 (short for Coronavirus Disease 2019) is a virus [believed](https://www.sciencedaily.com/releases/2020/03/200317175442.htm) to have developed in Wuhan, China in 2019. It looks like this using Transmission Electron Microscope:

![](/data/covid_plots/covid_virus.jpg)
*[Source](https://www.flickr.com/photos/niaid/49645120251/in/album-72157712914621487)*

Viruses are the smallest infectious microbes composed of DNA/RNA surrounded by a protein shell. When a virus enters a living cell it modifies the cell's actions. It can force the cell to produce more viruses which can burst out of the host cell, killing the host cell and going on to infect other cells. See this [video](https://www.youtube.com/watch?v=5DGwOJXSxqg) for more information. COVID-19 (as well as SARS and the common cold) is a coronavirus. Coronaviruses are a class of viruses with spiky projections on their outer surface. These spikes are protein receptors that allow the virus to attach and enter host cells. Determining the molecular structure of these proteins may lead to the development of a successful vaccine as described [here](https://www.livescience.com/coronavirus-spike-protein-structure.html).

So far it appears the infection and death rate for COVID-19 is larger than the flu. However, this number has varied widely across the world indicating it depends on other factors. See [this article](https://www.livescience.com/new-coronavirus-compare-with-flu.html) for more information. 

It is easy to deny the reality of an issue when it is not immediately physical (e.g. on your doorstep). Towards this end, let's take a look at the current data and project into the future.

As the availability and use of COVID testing has widely varied across the globe, the number of cases is not well understood, or at least comparable between regions. On the other hand, death rates from COVID appear to be more accurate so far. Looking at the number of deaths so far in the plot below, we can see that the outbreak began in Hubei. It began in Europe about a month later, and in the US another two weeks later.


<figure class="half" style="display:flex">
  <img style="width:60%" src="/data/covid_plots/total_deaths_raw_dates_linear.png">
  <img style="width:60%" src ="/data/covid_plots/total_deaths_raw_dates_log.png">
  <!--<figcaption>Maybe I'll write a caption.</figcaption> -->
</figure>

We can also see how this outbreak developed spatially in the US by plotting the number of deaths vs. date here:
![](https://media.githubusercontent.com/media/tashwoods/tashwoods.github.io/master/data/covid_plots/total_deaths.gif)

From this plot it is hard to compare the death rates, since each country has a different population. So let's look at the number of deaths per one million people:


<figure class="half" style="display:flex">
  <img style="width:60%" src="/data/covid_plots/deaths_per_mil_raw_dates_linear.png">
  <img style="width:60%" src ="/data/covid_plots/deaths_per_mil_raw_dates_log.png">
  <!--<figcaption>Maybe I'll write a caption.</figcaption> -->
</figure>
![](https://media.githubusercontent.com/media/tashwoods/tashwoods.github.io/master/data/covid_plots/deaths_per_mil.gif)

Note in all the GIFs gray areas have no cases or data for the plotted time period and black areas are 'off the charts.'

Now we can see that so far the percentage of people that died from COVID is largest in Hubei, followed by Italy and King County, WA. The steep slope of the other countries, is not encouraging. However, looking at South Korea we can see that they have significantly decreased their death rate through their mitigation strategies.

However, it is still a bit difficult to compare the outbreaks in each country, since COVID hit each country at different times. So let's define 'CV Outbreak days' as the number of days since 10 COVID deaths and plot this against the total number of deaths:

<figure class="half" style="display:flex">
  <img style="width:60%" src="/data/covid_plots/total_deaths_raw_covid_days_linear.png">
  <img style="width:60%" src ="/data/covid_plots/total_deaths_raw_covid_days_log.png">
  <!--<figcaption>Maybe I'll write a caption.</figcaption> -->
</figure>
![](https://media.githubusercontent.com/media/tashwoods/tashwoods.github.io/master/data/covid_plots/total_deaths_cv_days.gif)

Plotted next to each area is the COVID growth rate (calculated as the slope of the linear fit plotted as the dashed line). From this plot South Korea is 'winning.' However, it is still hard to compare countries when we do not normalize the number of deaths by the population. So again, let's look at the number of deaths per one million people vs outbreak days. In this case, outbreak days are defined as the number of days since one death per million people.

<figure class="half" style="display:flex">
  <img style="width:60%" src="/data/covid_plots/deaths_per_mil_per_mil_covid_days_linear.png">
  <img style="width:60%" src ="/data/covid_plots/deaths_per_mil_per_mil_covid_days_log.png">
  <!--<figcaption>Maybe I'll write a caption.</figcaption> -->
</figure>
![](https://media.githubusercontent.com/media/tashwoods/tashwoods.github.io/master/data/covid_plots/deaths_per_mil_cv_days.gif)

Now we can see that South Korea has contained the outbreak the most with a growth rate of 1.05, while the US has the largest growth rate, at 1.25. Idealistically, if the US was able to 'flatten the curve,' matching South Korea's growth rate ~1,500 lives would be saved in Los Angeles County.

![LA All Lives Saved](/data/covid_plots/LA_lives_saved_all.png)

But it is still easy to think one person's actions do not contribute much (e.g. it's fine if I don't self isolate). So let's break down these numbers more. Assuming each person contributes equally to their countries growth rate (which is not true, but we will start with this assumption). Then calculating the difference between a South Korean's individual contribution to the growth rate and an American, we have the change to the American growth rate due to one individual. Plotting the changes in the number of deaths in Los Angeles if one person acts like a South Korean we have:

![LA Indiv Lives Saved](/data/covid_plots/LA_lives_saved_indiv.png)

However, these approximations assume that the number of deaths grows exponentially indefinitely. This is obviously not the case - we cannot kill more people than there are. There are various models for pandemics (e.g. SIR), but let's start simply by fitting to a sigmoid curve, which is a decent first approximation that does not scale exponentially for all times. Fitting the number of deaths to a sigmoid curve we have:


<figure class="half" style="display:flex">
  <img style="width:60%" src="/data/covid_plots/allsigmoidfit_linear_scaled.png">
  <img style="width:60%" src ="/data/covid_plots/allsigmoidfit_log_scaled.png">
  <!--<figcaption>Maybe I'll write a caption.</figcaption> -->
</figure>

<figure class="half" style="display:flex">
  <img style="width:60%" src="/data/covid_plots/allsigmoidfit_linear_unscaled.png">
  <img style="width:60%" src ="/data/covid_plots/allsigmoidfit_log_unscaled.png">
  <!--<figcaption>Maybe I'll write a caption.</figcaption> -->
</figure>

![LA lives saved logistic](/data/covid_plots/all_logistic_lives_saved_Los_Angeles_unscaled.png)

The sigmoid fits are closer to reality, but have significant uncertainties and are very sensitive to inital conditions. So the hunt for the model that describes reality most accurately continues.

I am now building a model using a class of recurrent neural networks (RNNs) called long-short term memory cells (LSTM). RNNs are often used in machine translation and time series modelling. The internal states of RNNs store not only the input information but also the context of that input (e.g. information about other inputs/the past). This means as the algorithm processes training samples it uses information from the previous training samples as well to model the current sample. The algorithm is considered recursive in this context. In the case of predicting the number of COVID deaths on a given day, knowing the number of deaths the previous days is extremely helpful.

There are numerous resources that describe the history and architecture of LSTMs, so I will be brief in my remix here. LSTMs are composed of three main processing layers: forget gate, input gate, and the output gate. The forget gate takes a given input (number of deaths on a certain day) and the hidden state (information from the previous days) and decides what information to keep. This information is then passed to the 'memory' of the cell and the input gate. The input gate takes this information and decides which values to update in the memory of the cell and adds this to the memory of the cell. Finally, the output gate takes the information that passed the forget gate and decides what to keep in the hidden state for modeling the next input.

LSTM layers come in many flavors and meta-structures. After some testing, I decided to use a 'vanilla' two layer stacked LSTM with dropout. I trained the LSTM with data (new cases and deaths, total cases and deaths) up to a given day and had it predict the next five days. 

Here are RMSE vs. Epoch validation plots for the number of layers, LSTM hidden layer dimensions, and dropout values. 

![lstm layers](/data/covid_plots/lstm_loss_layers.png)
![lstm neurons](/data/covid_plots/lstm_loss_neurons.png)
![lstm dropout](/data/covid_plots/lstm_loss_dropout.png)

Based on these hyperparameter studies, I chose to use two layers with 100 neurons each and a final dropout layer of 0.01, as shown in this diagram. Note: masking was applied as the input sequences had varying lengths.

![lstm diagram](/data/covid_plots/model.png)

The RMSE for this architecture reaches a decent minima around 100 epochs as shown below.

![lstm epochs](/data/covid_plots/lstm_loss_final.png)

Finally, we can see the predicted number of deaths for five days in the future for every day in the training and test sets. The errors bars on the prediction were calculated using the same network but with a drop out of 0.2.

![lstm prediction](/data/covid_plots/Los_Angeles_lstm.png)

This LSTM prediction is decent, but obviously still match reality. Looking at the data more closely, this week the death rates in Los Angeles have decreased as shown below (for the other areas as well).

![Death Growth Rate](/data/covid_plots/death_growth_rate.jpg)

The death rate is calculated as the slope of the log-linear fit to the number of deaths from the past five days. This number is quite abstract though. So, let's consider the doubling time of deaths, or the number of days until the number of total deaths doubles. Longer doubling times means less deaths.

![Doubling Time](/data/covid_plots/doubling_time.jpg)

Note that China was off the scale here, but in case you are curious here is the uncropped plot for doubling time.

![china](/data/covid_plots/china.jpg)

From these plots, it is safe to conclude that social distancing measures have decreased the number of deaths. Moreover, individual actions do matter and can weaken this pandemic. As Dr. Deborah Birx [said](https://www.npr.org/2020/03/31/823916343/coronavirus-task-force-set-to-detail-the-data-that-led-to-extension-of-guideline) we currently have 'no magic bullet, it's just our behaviors that dictate the course of this viral pandemic over the next thirty days.' 

However, continued shutdowns will likely have far reaching physicologial, physical, and economic tolls. Given all this, what is the best path forward? Best is relative to one's values, so I will leave it to you to decide. 








